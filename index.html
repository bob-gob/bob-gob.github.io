<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite 4 | Master Portal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --blue: #00d4ff; --green: #39FF14; --red: #ff4d4d; --bg: #0b101b; }
        body { background-color: var(--bg); color: var(--blue); font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; overflow-x: hidden; transition: border 0.3s; box-sizing: border-box; }
        
        /* Global Red Alert Logic */
        .global-lock-active { border: 15px solid var(--red) !important; animation: redPulse 1.5s infinite; }
        @keyframes redPulse { 0%, 100% { box-shadow: inset 0 0 50px var(--red); } 50% { box-shadow: inset 0 0 150px var(--red); } }

        .box { border: 2px solid var(--blue); padding: 40px; border-radius: 20px; text-align: center; box-shadow: 0 0 30px rgba(0, 212, 255, 0.2); background: rgba(0, 0, 0, 0.95); max-width: 500px; width: 90%; position: relative; z-index: 10; }
        
        /* Inputs & Buttons */
        .password-container { position: relative; width: 100%; max-width: 300px; margin: 20px auto; }
        input { background: #000; border: 1px solid var(--blue); color: var(--green); padding: 12px; text-align: center; width: 100%; outline: none; font-size: 1.1em; box-sizing: border-box; }
        button { background: var(--blue); border: none; padding: 12px 25px; cursor: pointer; font-weight: bold; color: #000; text-transform: uppercase; margin-top: 10px; border-radius: 5px; transition: 0.2s; }
        button:hover:not(:disabled) { background: var(--green); box-shadow: 0 0 15px var(--green); }
        button:disabled { opacity: 0.4; cursor: not-allowed; }

        /* Screens Visibility */
        #sync-screen, #wipe-screen, #login-screen, #loading-screen, #final-dashboard, #stats-page { display: none; }
        
        /* Loading Spinner */
        .spinner { border: 5px solid rgba(0, 212, 255, 0.1); border-left-color: var(--green); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Financials & Graphs */
        #final-dashboard, #stats-page { width: 95%; max-width: 1100px; flex-direction: column; align-items: center; padding: 40px 10px; }
        .dual-graph-wrapper { display: flex; width: 100%; gap: 30px; margin-top: 20px; flex-wrap: wrap; }
        .graph-container { display: flex; height: 250px; width: 100%; border-left: 2px solid var(--blue); border-bottom: 2px solid var(--blue); position: relative; background: rgba(0, 212, 255, 0.02); align-items: flex-end; justify-content: space-around; }
        .bar-wrapper { width: 7%; height: 100%; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; cursor: pointer; }
        .bar { width: 100%; transition: height 0.5s; }
        .bar.spent { background: linear-gradient(to top, var(--blue), var(--green)); }
        .bar.earned { background: linear-gradient(to top, var(--blue), #ff00ff); }

        /* UI Elements */
        .card { background: rgba(255, 255, 255, 0.05); border: 1px solid #333; padding: 20px; border-radius: 15px; margin-bottom: 20px; width: 100%; box-sizing: border-box; }
        .goal-container { width: 100%; height: 25px; background: #111; border-radius: 12px; margin-top: 10px; overflow: hidden; border: 1px solid var(--blue); position: relative; }
        #goal-bar { height: 100%; width: 0%; background: var(--green); transition: width 1s; }
        .kill-switch { background: var(--red); color: white; width: 100%; }
        .logout-btn { position: fixed; top: 20px; right: 20px; background: none; border: 1px solid var(--red); color: var(--red); padding: 5px 12px; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div class="box" id="sync-screen" style="display: block;">
        <div class="spinner"></div>
        <p>SYNCHRONIZING GLOBAL ENCRYPTION...</p>
    </div>

    <div class="box" id="wipe-screen">
        <h1 style="color: var(--red);">SYSTEM OVERRIDE</h1>
        <div id="maint-msg" style="background: rgba(255,0,0,0.1); padding: 10px; border: 1px dashed var(--red); margin: 10px 0; font-size: 0.9em;">
            NOTICE: UNUATHORIZED ACCESS ATTEMPT DETECTED. GLOBAL LOCK ACTIVE.
        </div>
        <div class="password-container">
            <input type="password" id="override-pass" placeholder="RESTORATION CODE">
        </div>
        <button onclick="globalRestore()" style="background: var(--red); color: white;">RESTORE GLOBAL ACCESS</button>
    </div>

    <div class="box" id="login-screen">
        <h1>ELITE 4 PORTAL</h1>
        <div class="password-container">
            <input type="password" id="user-pass" placeholder="ACCESS KEY">
        </div>
        <button id="validate-btn" onclick="checkLogin()">VALIDATE</button>
        <p id="lockout-msg" style="color:var(--red); display:none; margin-top:10px;">LOCKED: <span id="timer">30</span>s</p>
        <p id="attempt-warning" style="font-size: 0.7em; margin-top: 15px; color: var(--red);"></p>
    </div>

    <div class="box" id="loading-screen">
        <div class="spinner"></div>
        <h2>ACCESSING SECURE VAULT...</h2>
    </div>

    <div id="final-dashboard">
        <button class="logout-btn" onclick="location.reload()">LOG OUT</button>
        <h2 style="color: var(--green);">[SYSTEM_ONLINE_2026]</h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; width: 100%;">
            <div class="card">
                <h3>Financial Suite</h3>
                <button onclick="showStats()">View Revenue Graphs</button>
            </div>
            <div class="card">
                <h3>Global Logs</h3>
                <p>Global Overrides: <span id="event-total" style="color: var(--red);">0</span></p>
                <div id="qrcode" style="background: #fff; padding: 5px; width: 100px; height: 100px; margin-top: 10px;"></div>
            </div>
            <div class="card">
                <h3>Security Center</h3>
                <button class="kill-switch" onclick="manualKillSwitch()">TRIGGER GLOBAL LOCKDOWN</button>
            </div>
        </div>
    </div>

    <div id="stats-page">
        <button class="logout-btn" onclick="showDashboard()">BACK TO VAULT</button>
        <h2>FINANCIAL DATA</h2>
        <div class="dual-graph-wrapper">
            <div class="graph-section"><h3>SPENT</h3><div class="graph-container" id="spent-bars"></div></div>
            <div class="graph-section"><h3>EARNED</h3><div class="graph-container" id="earned-bars"></div></div>
        </div>
        <div class="card" style="text-align: center; margin-top: 20px;">
            <p>Net Profit: <span id="net-profit" style="color: var(--green);">$0</span></p>
            <div class="goal-container"><div id="goal-bar"></div></div>
            <p style="font-size: 0.8em; margin-top: 5px;">Goal Progress: <span id="goal-text">0%</span></p>
        </div>
    </div>

    <script>
        const NS = "elite4_final_master_v3";
        const KEY = "portal_state";
        const API_GET = `https://api.counterapi.dev/v1/${NS}/${KEY}`;
        const API_HIT = `https://api.counterapi.dev/v1/${NS}/${KEY}/up`;
        const months = ["jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec"];
        
        let attempts = 0;
        let isLockedOut = false;

        async function init() {
            try {
                const res = await fetch(API_GET);
                const data = await res.json();
                document.getElementById('event-total').innerText = Math.floor(data.count / 2);
                
                if (data.count % 2 !== 0) {
                    document.body.classList.add('global-lock-active');
                    showScreen("wipe-screen");
                } else {
                    document.body.classList.remove('global-lock-active');
                    showScreen("login-screen");
                }
            } catch (err) {
                // First time setup: set to 2 (Even/Open)
                await fetch(API_HIT); await fetch(API_HIT);
                showScreen("login-screen");
            }
            setupBarUI();
            new QRCode(document.getElementById("qrcode"), { text: window.location.href, width: 100, height: 100 });
        }

        function showScreen(id) {
            document.querySelectorAll('.box, #final-dashboard, #stats-page').forEach(el => el.style.display = 'none');
            const target = document.getElementById(id);
            target.style.display = (id.includes('dashboard') || id.includes('stats')) ? "flex" : "block";
        }

        async function checkLogin() {
            if(isLockedOut) return;
            const pass = document.getElementById("user-pass").value.trim().toLowerCase();
            if (pass === "printing4") {
                showScreen("loading-screen");
                setTimeout(() => { showScreen("final-dashboard"); calculateFinance(); }, 1500);
            } else {
                attempts++;
                if (attempts === 5) {
                    isLockedOut = true;
                    document.getElementById("validate-btn").disabled = true;
                    document.getElementById("lockout-msg").style.display = "block";
                    let t = 30;
                    const itv = setInterval(() => {
                        t--; document.getElementById("timer").innerText = t;
                        if(t <= 0) { clearInterval(itv); isLockedOut = false; document.getElementById("validate-btn").disabled = false; document.getElementById("lockout-msg").style.display = "none"; }
                    }, 1000);
                } else if (attempts >= 10) {
                    await fetch(API_HIT); 
                    location.reload();
                } else {
                    document.getElementById("attempt-warning").innerText = `${10-attempts} ATTEMPTS REMAINING`;
                }
            }
        }

        async function manualKillSwitch() {
            if(confirm("ACTIVATE GLOBAL LOCKDOWN? THIS BLOCKS ALL USERS.")) {
                await fetch(API_HIT); location.reload();
            }
        }

        async function globalRestore() {
            if (document.getElementById("override-pass").value.trim().toLowerCase() === "18gb") {
                await fetch(API_HIT); alert("GLOBAL RESTORE SUCCESSFUL."); location.reload();
            } else { alert("ACCESS DENIED."); }
        }

        function setupBarUI() {
            ['spent', 'earned'].forEach(type => {
                const area = document.getElementById(`${type}-bars`);
                months.forEach(m => {
                    const wrap = document.createElement('div'); wrap.className = 'bar-wrapper';
                    wrap.onclick = (e) => {
                        const val = Math.round((1 - (e.offsetY / 250)) * 20) * 5;
                        localStorage.setItem(`e4m-${type}-${m}`, val);
                        calculateFinance();
                    };
                    const bar = document.createElement('div'); bar.className = `bar ${type}`;
                    bar.id = `bar-${type}-${m}`;
                    wrap.appendChild(bar); area.appendChild(wrap);
                });
            });
        }

        function calculateFinance() {
            let sT = 0, eT = 0;
            months.forEach(m => {
                const s = parseInt(localStorage.getItem(`e4m-spent-${m}`) || 0);
                const e = parseInt(localStorage.getItem(`e4m-earned-${m}`) || 0);
                sT += s; eT += e;
                document.getElementById(`bar-spent-${m}`).style.height = s + '%';
                document.getElementById(`bar-earned-${m}`).style.height = e + '%';
            });
            const net = eT - sT;
            document.getElementById("net-profit").innerText = "$" + net;
            const perc = Math.min(100, (net / 120) * 100);
            document.getElementById("goal-bar").style.width = perc + "%";
            document.getElementById("goal-text").innerText = Math.floor(perc) + "%";
        }

        function showStats() { showScreen("stats-page"); calculateFinance(); }
        function showDashboard() { showScreen("final-dashboard"); }

        init();
    </script>
</body>
</html>
